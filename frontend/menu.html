<!DOCTYPE html>
<html>
<head>
    <title>Menu</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<h2>Food Menu</h2>
<a href="../backend/logout.php">Logout</a>
<div id="menu"></div>

<h3>Your Cart</h3>
<ul id="cartItems"></ul>
<p>Total: $<span id="total">0.00</span></p>
<button id="placeOrderBtn">Place Order</button>

<script>
let cart = [];

function fetchMenu() {
    fetch('../backend/get_foods.php')
    .then(res => res.json())
    .then(data => {
        const menuDiv = document.getElementById('menu');
        menuDiv.innerHTML = '';
        data.forEach(food => {
            const div = document.createElement('div');
            div.innerHTML = `
                <b>${food.food_name}</b> - $${food.price} <button onclick="addToCart(${food.food_id}, '${food.food_name}', ${food.price})">Add to Cart</button>
            `;
            menuDiv.appendChild(div);
        });
    });
}

function addToCart(id, name, price){
    let item = cart.find(i => i.id === id);
    if(item){
        item.qty++;
    } else {
        cart.push({id, name, price, qty:1});
    }
    renderCart();
}

function renderCart(){
    const cartList = document.getElementById('cartItems');
    const totalSpan = document.getElementById('total');
    cartList.innerHTML = '';
    let total = 0;
    cart.forEach(item => {
        cartList.innerHTML += <li>${item.name} x ${item.qty} - $${(item.price*item.qty).toFixed(2)}</li>;
        total += item.price*item.qty;
    });
    totalSpan.innerText = total.toFixed(2);
}

document.getElementById('placeOrderBtn').addEventListener('click', ()=>{
    if(cart.length === 0){
        alert('Your cart is empty!');
        return;
    }

    fetch('../backend/place_order.php',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(cart)
    })
    .then(res => res.text())
    .then(msg => {
        alert(msg + "\nPlease Pay at counter");
        cart = [];
        renderCart();
    });
});

fetchMenu();
</script>
</body>
</html>
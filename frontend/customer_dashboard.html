<!DOCTYPE html>
<html>
<head>
    <title>Customer Dashboard</title>
</head>
<body>

<h2>Welcome, Customer</h2>
<button onclick="logout()">Logout</button>

<h3>Categories</h3>
<div id="categories"></div>

<h3>Foods</h3>
<div id="foods"></div>

<script>
function logout(){
    fetch("../backend/logout.php")
    .then(() => {
        window.location.href = "login.html";
    })
    .catch(err => console.error("Logout failed:", err));
}

function loadCategories(){
    fetch("../backend/get_categories.php")
    .then(res => res.json())
    .then(categories => {
        const catDiv = document.getElementById("categories");
        catDiv.innerHTML = "";
        categories.forEach(cat => {
            const btn = document.createElement("button");
            btn.innerText = cat.category_name;
            btn.onclick = () => loadFoods(cat.category_id);
            catDiv.appendChild(btn);
        });
    });
}

function loadFoods(cat_id){
    fetch(../backend/get_foods.php?category_id=${cat_id})
    .then(res => res.json())
    .then(foods => {
        const foodsDiv = document.getElementById("foods");
        foodsDiv.innerHTML = "";
        foods.forEach(f => {
            foodsDiv.innerHTML += `<p><b>${f.food_name}</b>: ${f.description} - Tsh.${f.price}
            <input type="number" id="qty${f.food_id}" value="1" min="1">
            <button onclick="addToCart(${f.food_id})">Add to Cart</button></p>`;
        });
    });
}

function addToCart(food_id){
    const quantity = document.getElementById('qty'+food_id).value;
    fetch("../backend/add_to_cart.php", {
        method: "POST",
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: food_id=${food_id}&quantity=${quantity}
    })
    .then(res => res.json())
    .then(res => alert(res.message));
}

function placeOrder(){
    fetch("../backend/place_order.php", {method:'POST'})
    .then(res => res.json())
    .then(res => alert(res.message));
}

loadCategories();
</script>

<!-- Register link removed from dashboard -->
</body>
</html>
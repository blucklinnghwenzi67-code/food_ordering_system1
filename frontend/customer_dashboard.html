<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Customer Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { margin: 5px; padding: 5px 10px; cursor: pointer; }
        #category-buttons button { margin-right: 10px; }
        .food-item { border: 1px solid #ccc; padding: 10px; margin: 5px 0; }
        .cart-item { border-bottom: 1px solid #ddd; padding: 5px 0; }
        h2, h3 { margin-bottom: 10px; }
    </style>
</head>
<body>

<h2>Welcome, Customer!</h2>

<!-- Tabs -->
<button onclick="showSection('menu')">Menu</button>
<button onclick="showSection('orders')">My Orders</button>

<hr>

<!-- Menu Section -->
<div id="menu-section" style="display:none;">
    <h3>Menu</h3>
    <!-- Category Buttons -->
    <div id="category-buttons"></div>

    <!-- Foods List -->
    <div id="food-list"></div>

    <!-- Cart Section -->
    <h4>Cart</h4>
    <div id="cart-list"></div>
    <p>Total: Tsh <span id="cart-total">0</span></p>
    <button onclick="placeOrder()">Place Order</button>
</div>

<!-- Orders Section -->
<div id="orders-section" style="display:none;">
    <h3>My Orders</h3>
    <div id="orders-list">No orders yet.</div>
</div>

<script>
let cart = [];

// Show Menu or Orders section
function showSection(section){
    document.getElementById('menu-section').style.display = section==='menu'?'block':'none';
    document.getElementById('orders-section').style.display = section==='orders'?'block':'none';
}

// Load categories from backend
fetch('../backend/get_categories.php')
.then(res => res.json())
.then(categories => {
    const btnDiv = document.getElementById('category-buttons');
    categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.textContent = cat.category_name;
        btn.onclick = () => loadFoods(cat.category_id);
        btnDiv.appendChild(btn);
    });

    // Load first category by default
    if(categories.length > 0) loadFoods(categories[0].category_id);
});

// Load foods based on category
function loadFoods(category_id){
    fetch('../backend/get_foods.php?category_id=' + category_id)
    .then(res => res.json())
    .then(foods => {
        const foodDiv = document.getElementById('food-list');
        foodDiv.innerHTML = '';
        foods.forEach(food => {
            const div = document.createElement('div');
            div.className = 'food-item';
            div.innerHTML = `<strong>${food.food_name}</strong> - Tsh ${parseFloat(food.price).toLocaleString()}
                             <p>${food.description || ''}</p>
                             <button onclick="addToCart(${food.food_id}, '${food.food_name}', ${food.price})">Add to Cart</button>`;
            foodDiv.appendChild(div);
        });
    });
}

// Add food to cart
function addToCart(id, name, price){
    cart.push({id, name, price});
    renderCart();
}

// Render cart
function renderCart(){
    const cartDiv = document.getElementById('cart-list');
    cartDiv.innerHTML = '';
    let total = 0;
    cart.forEach((item,index) => {
        total += parseFloat(item.price);
        cartDiv.innerHTML += `<div class="cart-item">${item.name} - Tsh ${parseFloat(item.price).toLocaleString()} 
        <button onclick="removeFromCart(${index})">Remove</button></div>`;
    });
    document.getElementById('cart-total').textContent = total.toLocaleString();
}

// Remove item from cart
function removeFromCart(index){
    cart.splice(index,1);
    renderCart();
}

// Place order (temporary alert)
function placeOrder(){
    if(cart.length === 0){
        alert('Cart is empty!');
        return;
    }
    let total = cart.reduce((a,b)=>a+parseFloat(b.price),0).toLocaleString();
    alert('Order placed! Total: Tsh ' + total);
    cart = [];
    renderCart();
}

// Show menu section by default
showSection('menu');
</script>

</body>
</html>